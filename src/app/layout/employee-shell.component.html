<div class="min-h-screen bg-muted/40 text-sm text-foreground antialiased">
  <header class="sticky top-0 z-30 border-b bg-background/90 backdrop-blur">
    <div class="flex w-full items-center justify-between gap-4 px-4 py-3 md:px-8 xl:px-12">
      <div class="flex items-center gap-3" *ngIf="profile()">
        <div class="flex size-9 items-center justify-center rounded-lg bg-primary/10 text-primary">
          <span class="text-sm font-semibold">{{ profile()!.fullName.charAt(0).toUpperCase() }}</span>
        </div>
        <div>
          <p class="text-xs text-muted-foreground">Employee Workspace</p>
          <h1 class="text-base font-semibold">{{ profile()!.fullName }}</h1>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <div class="text-right text-xs text-muted-foreground">
          <p class="font-semibold text-foreground">Daily reporting</p>
          <p class="mt-0.5">Log your day and raise incidents fast.</p>
        </div>
        <button
          type="button"
          (click)="logout()"
          [disabled]="loggingOut()"
          [title]="loggingOut() ? 'Signing out...' : 'Sign out'"
          class="flex size-9 items-center justify-center rounded-lg border border-input bg-background text-muted-foreground transition hover:bg-destructive hover:text-destructive-foreground disabled:opacity-50"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" class="size-4">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="16 17 21 12 16 7" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="21" y1="12" x2="9" y2="12" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main class="w-full px-4 py-8 md:px-8 xl:px-12">
    <section
      *ngIf="missingReportAlerts().length"
      class="mb-8 rounded-3xl border border-amber-300 bg-amber-50 px-5 py-4 text-amber-700 shadow-sm"
    >
      <p class="text-xs font-semibold uppercase tracking-wide">Daily report reminder</p>
      <p class="mt-1 text-xs">
        No submission logged for
        <span class="font-semibold">{{ missingReportAlerts().join(', ') }}</span>.
      </p>
    </section>

    <div class="grid gap-8 xl:gap-10 2xl:grid-cols-[minmax(0,2.2fr)_minmax(320px,1fr)]">
      <div class="space-y-8 2xl:space-y-10">
        <section class="rounded-3xl border bg-card/90 shadow-lg ring-1 ring-primary/5">
          <div class="border-b border-border/60 px-6 py-5 sm:flex sm:items-start sm:justify-between sm:gap-6">
            <div>
              <p class="text-xs font-semibold uppercase tracking-wide text-primary">Daily log</p>
              <h2 class="mt-1 text-xl font-semibold text-foreground">Daily report for {{ todayLabel }}</h2>
              <p class="mt-1 text-xs text-muted-foreground">
                Capture each hour and send updates straight to your lead.
              </p>
            </div>
            <div class="mt-4 flex flex-wrap items-center gap-3 text-xs text-muted-foreground sm:mt-0 sm:justify-end">
              <span *ngIf="lastDailyReportSavedAt()">Saved {{ lastDailyReportSavedAt() | date: 'shortTime' }}</span>
              <button
                type="button"
                class="inline-flex items-center gap-1 rounded-full border border-input px-3 py-1 font-semibold text-muted-foreground transition hover:text-foreground"
                (click)="resetForm()"
              >
                Reset hour form
              </button>
              <button
                type="button"
                class="inline-flex items-center gap-1 rounded-full border border-input px-3 py-1 font-semibold text-muted-foreground transition hover:text-foreground"
                (click)="clearEntries()"
              >
                Clear entries
              </button>
            </div>
          </div>

          <div class="px-6 pb-6 pt-5">
            <div
              *ngIf="dailyReportError()"
              class="mb-4 rounded-2xl border border-destructive/50 bg-destructive/10 px-4 py-3 text-xs text-destructive"
            >
              {{ dailyReportError() }}
            </div>
            <div
              *ngIf="dailyReportNotice()"
              class="mb-4 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 px-4 py-3 text-xs text-emerald-600"
            >
              {{ dailyReportNotice() }}
            </div>

            <div
              *ngIf="dailyReportLoading()"
              class="rounded-2xl border border-dashed border-input bg-background/80 px-6 py-10 text-center text-sm text-muted-foreground"
            >
              Loading today's log...
            </div>

            <ng-container *ngIf="!dailyReportLoading()">
              <div class="grid gap-6 lg:grid-cols-[minmax(0,1.6fr)_minmax(280px,1fr)]">
                <div class="space-y-6">
                  <form
                    class="grid gap-3 sm:grid-cols-[minmax(0,140px)_1fr_auto]"
                    [formGroup]="entryForm"
                    (ngSubmit)="submitEntry()"
                  >
                    <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground">
                      Hour
                      <select
                        formControlName="hour"
                        class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
                      >
                        <option *ngFor="let slot of timeSlots" [value]="slot">{{ slot }}</option>
                      </select>
                    </label>

                    <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground sm:col-span-1">
                      What did you work on?
                      <textarea
                        formControlName="activity"
                        rows="2"
                        placeholder="Draft release notes, resolved customer escalations, paired with QA..."
                        class="min-h-[2.75rem] w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
                      ></textarea>
                    </label>

                    <button
                      type="submit"
                      class="rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-primary/90"
                    >
                      {{ editingHour() ? 'Update hour' : 'Add hour' }}
                    </button>
                  </form>

                  <div *ngIf="entries().length; else emptyEntries" class="overflow-hidden rounded-2xl border border-input">
                    <table class="min-w-full divide-y divide-border text-sm">
                      <thead class="bg-muted/60 text-[11px] uppercase tracking-wide text-muted-foreground">
                        <tr>
                          <th class="px-4 py-3 text-left font-medium">Hour</th>
                          <th class="px-4 py-3 text-left font-medium">Summary</th>
                          <th class="px-4 py-3 text-right font-medium">Actions</th>
                        </tr>
                      </thead>
                      <tbody class="divide-y divide-border bg-background/70">
                        <tr *ngFor="let entry of entries()" class="align-top">
                          <td class="px-4 py-3 font-semibold text-foreground">{{ entry.hour }}</td>
                          <td class="px-4 py-3 text-sm text-muted-foreground">{{ entry.activity }}</td>
                          <td class="px-4 py-3">
                            <div class="flex items-center justify-end gap-2 text-xs font-semibold">
                              <button
                                type="button"
                                class="rounded-lg border border-input px-2.5 py-1 text-muted-foreground transition hover:text-foreground"
                                (click)="editEntry(entry)"
                              >
                                Edit
                              </button>
                              <button
                                type="button"
                                class="rounded-lg border border-destructive/40 px-2.5 py-1 text-destructive transition hover:bg-destructive/10"
                                (click)="removeEntry(entry.hour)"
                              >
                                Remove
                              </button>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <ng-template #emptyEntries>
                    <div class="rounded-2xl border border-dashed border-input bg-background/80 px-6 py-10 text-center text-sm text-muted-foreground">
                      No entries yet. Add what you accomplished this hour so your lead sees steady progress.
                    </div>
                  </ng-template>
                </div>

                <div class="space-y-4">
                  <div class="rounded-2xl border border-input bg-background/70 p-5">
                    <div class="flex items-center justify-between text-xs text-muted-foreground">
                      <span class="font-semibold text-foreground">Hours logged</span>
                      <span>{{ hoursLogged() }} / {{ timeSlots.length }}</span>
                    </div>
                    <div class="mt-3 h-2 w-full rounded-full bg-muted">
                      <div
                        class="h-full rounded-full bg-primary transition-all"
                        [style.width.%]="completionPercent()"
                      ></div>
                    </div>
                    <p class="mt-2 text-xs text-muted-foreground">{{ completionPercent() }}% of day captured</p>
                    <div
                      *ngIf="missingCount()"
                      class="mt-3 inline-flex items-center gap-2 rounded-full bg-amber-100 px-3 py-1 text-[11px] font-semibold text-amber-700"
                    >
                      <span class="inline-flex size-2 rounded-full bg-amber-500"></span>
                      {{ missingCount() }} previous day(s) missing
                    </div>
                  </div>

                  <form
                    class="space-y-3 rounded-2xl border border-input bg-background/70 p-5"
                    [formGroup]="dailyMetaForm"
                    (ngSubmit)="saveDailyReport()"
                  >
                    <label class="flex flex-col gap-2 text-xs font-medium text-muted-foreground">
                      Notes for your lead
                      <textarea
                        formControlName="notes"
                        rows="3"
                        placeholder="Highlights, blockers, or reminders..."
                        class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
                      ></textarea>
                    </label>

                    <label class="flex items-start gap-3 rounded-xl bg-card/60 p-3 text-xs text-muted-foreground">
                      <input
                        type="checkbox"
                        formControlName="complete"
                        class="mt-1 size-4 rounded border-input text-primary focus:ring-primary/30"
                      />
                      <span>
                        <span class="block font-semibold text-foreground">Mark day complete</span>
                        <span class="mt-1 block leading-5">
                          Uncheck if you plan to add more context later today.
                        </span>
                      </span>
                    </label>

                    <button
                      type="submit"
                      class="w-full rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-primary/90 disabled:opacity-70"
                      [disabled]="dailyReportSaving()"
                    >
                      <ng-container *ngIf="dailyReportSaving(); else saveLabel">Saving...</ng-container>
                      <ng-template #saveLabel>Save daily report</ng-template>
                    </button>
                  </form>
                </div>
              </div>
            </ng-container>
          </div>
        </section>
      </div>

      <aside class="space-y-8 2xl:space-y-10 2xl:pl-4">
        <section class="rounded-3xl border bg-card/90 p-6 shadow-sm">
          <div class="flex items-start justify-between gap-3">
            <div>
              <h3 class="text-base font-semibold text-foreground">Incident report</h3>
              <p class="mt-1 text-xs text-muted-foreground">
                Logged under trainingRecords/{{ traineeRecordId() }}/incedentReports.
              </p>
            </div>
            <span
              *ngIf="traineeRecordId(); else missingTrainee"
              class="inline-flex items-center rounded-full bg-primary/10 px-3 py-1 text-[11px] font-semibold text-primary"
            >
              ID ready
            </span>
            <ng-template #missingTrainee>
              <span class="inline-flex items-center rounded-full bg-destructive/10 px-3 py-1 text-[11px] font-semibold text-destructive">
                Missing ID
              </span>
            </ng-template>
          </div>

          <div
            *ngIf="incidentError()"
            class="mt-4 rounded-2xl border border-destructive/40 bg-destructive/10 px-3 py-2 text-xs text-destructive"
          >
            {{ incidentError() }}
          </div>
          <div
            *ngIf="incidentNotice()"
            class="mt-4 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 px-3 py-2 text-xs text-emerald-600"
          >
            {{ incidentNotice() }}
          </div>

          <form class="mt-4 space-y-4" [formGroup]="incidentForm" (ngSubmit)="submitIncident()">
            <div class="grid gap-3 md:grid-cols-2">
              <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground">
                Date
                <input
                  type="date"
                  formControlName="date"
                  class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
                />
              </label>
              <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground">
                Severity
                <select
                  formControlName="severity"
                  class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
                >
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                  <option value="critical">Critical</option>
                </select>
              </label>
            </div>

            <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground">
              Title
              <input
                type="text"
                formControlName="title"
                placeholder="Short summary"
                class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
              />
            </label>

            <div class="grid gap-3 md:grid-cols-2">
              <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground">
                Status
                <select
                  formControlName="status"
                  class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
                >
                  <option value="Open">Open</option>
                  <option value="Monitoring">Monitoring</option>
                  <option value="Resolved">Resolved</option>
                </select>
              </label>
              <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground">
                Reported by
                <input
                  type="text"
                  formControlName="reportedBy"
                  placeholder="Name submitting the report"
                  class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
                />
              </label>
            </div>

            <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground">
              Summary
              <textarea
                formControlName="summary"
                rows="3"
                placeholder="What happened?"
                class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
              ></textarea>
            </label>

            <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground">
              Impact
              <textarea
                formControlName="impact"
                rows="3"
                placeholder="Customer, operational, or trainee impact"
                class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
              ></textarea>
            </label>

            <label class="flex flex-col gap-1 text-xs font-medium text-muted-foreground">
              Follow-up actions
              <textarea
                formControlName="actions"
                rows="4"
                placeholder="One action per line"
                class="w-full rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground outline-none ring-primary/20 transition focus:ring-2"
              ></textarea>
            </label>

            <button
              type="submit"
              class="w-full rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-primary/90 disabled:opacity-70"
              [disabled]="incidentSaving() || !traineeRecordId()"
            >
              <ng-container *ngIf="incidentSaving(); else incidentLabel">Submitting...</ng-container>
              <ng-template #incidentLabel>Submit incident</ng-template>
            </button>
          </form>
        </section>
      </aside>
    </div>
  </main>
</div>
